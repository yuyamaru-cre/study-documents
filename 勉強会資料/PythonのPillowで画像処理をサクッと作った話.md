
Pythonで画像処理を行うための強力なライブラリ、Pillow（PILの後継）を紹介します。

*   **主な機能:**
    *   画像のアップロード
    *   画像加工（リサイズ、回転、ぼかし、グレースケール、セピア、オーバーレイなど）
    *   加工済み画像のダウンロード

### ライブラリ選定のポイント

#### OpenCV：高機能だが色の扱いに注意

*   **特徴:**
    *   画像処理、画像解析、機械学習など、多岐にわたる機能を提供
    *   リアルタイム処理に強く、組み込みシステムやロボティクス分野で広く利用
*   **注意点:**
    *   **色の変化:**
        *   画像処理の過程で、明度や彩度が変化しやすい
        *   原因：
            1.  デフォルトの色空間がBGRであること（一般的なRGBと異なる）
            2.  データ型の範囲を超えた演算による色のクリップ
            3.  コーデックによる色の劣化
    *   **対策:**
        *   `cv2.cvtColor()`で色空間を変換
        *   データ型を適切に管理
        *   可逆圧縮形式（PNGなど）を使用
*   **→ 対策が必要で、手間がかかる場合がある**

#### Pillow（PIL）：シンプルで扱いやすい

*   **特徴:**
    *   画像処理に特化しており、シンプルで直感的なAPIを提供
    *   様々な画像形式をサポートし、基本的な画像編集、加工、変換が容易
*   **メリット:**
    *   **色の変化が少ない:**
        *   デフォルトの色空間がRGBであるため、OpenCVのような色空間変換の手間が少ない
        *   色の管理が比較的容易で、意図しない色の変化が起こりにくい
    *   **扱いやすさ:**
        *   APIが直感的で、初心者でも扱いやすい
        *   Webアプリケーションとの連携が容易
*   **→ 色の管理が容易で、Web用途にも適している**

### OpenCVで起こったまさかの挙動

**印刷・出版関係**で作られた画像だと色が変化する

ICCプロファイル =「この画像の色はこう表示してね」という設定ファイル
その中でもJapan Color（日本の印刷業界標準）で設定されてると
OpenCVではプロファイルの情報をうまく拾えていないのか、以下のようになる。

| before                                          | after                                                   |
| ----------------------------------------------- | ------------------------------------------------------- |
| ![[IMG_20250607_192630989_NV_with_profile.jpg]] | ![[processed_a370d39c-dc67-474c-b6b7-d183b6d23194.png]] |

しかし、画像（写真）によっては影響がほぼない

| before                          | after                                                   |
| ------------------------------- | ------------------------------------------------------- |
| ![[transcend_with_profile.jpg]] | ![[processed_587f4226-142a-430a-8dfc-9936203af133.png]] |

実写の場合、色の量が多くグラデーションが微調整の幅が多くその分情報量多く繊細。
アニメ・イラスト画の場合は原色が多く高彩度でグラデーションが少ないので、ICCプロファイルのありなしの変化がさほど多くない模様...

しかしPillowでは起きなかった。（なんで？）

### Pillowライブラリの基本

*   **Pillowとは:**
    *   Python Imaging Library (PIL) の後継として開発された、画像処理ライブラリ。
    *   様々な画像形式をサポートし、画像編集、加工、変換など、豊富な機能を提供。
*   **主な機能:**
    *   画像の読み込みと保存
    *   画像のリサイズ、回転、切り抜き
    *   色調補正、フィルタ処理
    *   図形描画、テキスト描画
    *   画像形式の変換

### コード解説：画像処理APIの主要部分

1.  **画像の読み込み:**

    ```python
    from PIL import Image

    # 画像ファイルを読み込む
    image = Image.open("image.jpg")
    ```
2.  **画像のリサイズ:**

    ```python
    # 画像サイズを変更する
    resized_image = image.resize((800, 600))  # 幅800px、高さ600pxにリサイズ
    ```
3.  **画像の回転:**

    ```python
    # 画像を回転する
    rotated_image = image.rotate(45)  # 45度回転
    ```
4.  **フィルタ処理:**

    ```python
    from PIL import ImageFilter

    # 画像にぼかしフィルタを適用する
    blurred_image = image.filter(ImageFilter.GaussianBlur(radius=5))
    ```
5.  **画像の色調変換:**

    ```python
    # グレースケールに変換
    grayscale_image = image.convert('L')
    ```
6.  **画像の保存:**

    ```python
    # 処理後の画像を保存する
    resized_image.save("resized_image.jpg")
    ```

### まとめ

Pyhonでの画像処理というか、画像って奥深い。
